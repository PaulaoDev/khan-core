<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="robots" content="index, follow, all" />
    <title>Build | Khan framework Docs</title>

            <link rel="stylesheet" type="text/css" href="css/normalize.css">
        <link rel="stylesheet" type="text/css" href="css/min.css">
        <link rel="stylesheet" type="text/css" href="css/prism.css">
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700,400italic' rel='stylesheet' type='text/css'>
        <script src="js/prism.js"></script>
        <meta name="MobileOptimized" content="width">
        <meta name="HandheldFriendly" content="true">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    
    
    </head>

    <body id="class" data-name="class:Build" data-root-path="">
            <nav>
    <div class="container">
      <div class="title">
        <a href="index.html">Khan framework Docs</a>
      </div>
      <ul>
        <li><a href="classes.html">Classes</a></li>
                  <li><a href="namespaces.html">Namespaces</a></li>
                <li><a href="interfaces.html">Interfaces</a></li>
        <li><a href="traits.html">Traits</a></li>
        <li><a href="doc-index.html">Index</a></li>
        <li><a href="search.html">Search</a></li>
      </ul>
              </div>
  </nav>

  <div class="container">
    <div class="row">
        <div id="control-panel">
      </div>

        <div id="api-tree"></div>

    </div>
    <div class="row">
          <h1>Build</h1>

    <p>    class
    <strong>Build</strong>
</p>

    
    
    
    
            <h2>Methods</h2>

            <table class="table">
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method___construct">__construct</a>()</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            protected                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_print">print</a>($text)</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_request">request</a>()</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_checkVersion">checkVersion</a>($repo)</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_compare">compare</a>($date1)</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_rm">rm</a>($name)</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_extractAndMove">extractAndMove</a>($zipFile)</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_downloadZip">downloadZip</a>()</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"></code></td>
            <td>
                <code class="language-php"><a href="#method_check">check</a>()</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
        </table>


        <h2>Details</h2>

            <div id="method-details">
                        <div>
        <div class="float-right">
                            at line <a href="#source.7">7</a>
                    </div>
        <div>
            <h3 id="method___construct"><code class="language-php">__construct()</code></h3>
            <code class="language-php">public __construct()</code>
        </div>
    </div>

    <div class="details">
                
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.9">9</a>
                    </div>
        <div>
            <h3 id="method_print"><code class="language-php">print()</code></h3>
            <code class="language-php">protected print($text)</code>
        </div>
    </div>

    <div class="details">
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td></td>
                <td><code class="language-php">$text</code></td>
                <td></td>
            </tr>
            </table>

        
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.13">13</a>
                    </div>
        <div>
            <h3 id="method_request"><code class="language-php">request()</code></h3>
            <code class="language-php">public request()</code>
        </div>
    </div>

    <div class="details">
                
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.33">33</a>
                    </div>
        <div>
            <h3 id="method_checkVersion"><code class="language-php">checkVersion()</code></h3>
            <code class="language-php">public checkVersion($repo)</code>
        </div>
    </div>

    <div class="details">
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td></td>
                <td><code class="language-php">$repo</code></td>
                <td></td>
            </tr>
            </table>

        
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.41">41</a>
                    </div>
        <div>
            <h3 id="method_compare"><code class="language-php">compare()</code></h3>
            <code class="language-php">public compare($date1)</code>
        </div>
    </div>

    <div class="details">
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td></td>
                <td><code class="language-php">$date1</code></td>
                <td></td>
            </tr>
            </table>

        
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.59">59</a>
                    </div>
        <div>
            <h3 id="method_rm"><code class="language-php">rm()</code></h3>
            <code class="language-php">public rm($name)</code>
        </div>
    </div>

    <div class="details">
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td></td>
                <td><code class="language-php">$name</code></td>
                <td></td>
            </tr>
            </table>

        
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.63">63</a>
                    </div>
        <div>
            <h3 id="method_extractAndMove"><code class="language-php">extractAndMove()</code></h3>
            <code class="language-php">public extractAndMove($zipFile)</code>
        </div>
    </div>

    <div class="details">
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td></td>
                <td><code class="language-php">$zipFile</code></td>
                <td></td>
            </tr>
            </table>

        
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.118">118</a>
                    </div>
        <div>
            <h3 id="method_downloadZip"><code class="language-php">downloadZip()</code></h3>
            <code class="language-php">public downloadZip()</code>
        </div>
    </div>

    <div class="details">
                
        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.142">142</a>
                    </div>
        <div>
            <h3 id="method_check"><code class="language-php">check()</code></h3>
            <code class="language-php">public check()</code>
        </div>
    </div>

    <div class="details">
                
        
        
            </div>

            </div>

    
    <h2>Source code</h2>
    <pre class="language-php line-numbers" id="source"><code>&lt;?php
	
	date_default_timezone_set(&#039;America/Sao_Paulo&#039;);

	class Build {

		public function __construct(){}

		protected function print($text){
			echo &quot;\n   {$text}\n&quot;;
		}

		public function request(){
			
			$opts = [
			        &#039;http&#039; =&gt; [
			                 &#039;user_agent&#039; =&gt; &#039;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:13.0) Gecko/20100101 Firefox/13.0.1&#039;
			        ]
			];

			$context = stream_context_create($opts);
			$repo = file_get_contents(&quot;https://api.github.com/repos/PaulaoDev/router-khan&quot;, false, $context);
			$repo = (array) json_decode($repo);

			if(!file_exists(&#039;.cli/update/dates/last.txt&#039;)){
				echo $repo[&quot;update_at&quot;];
				file_put_contents(&#039;.cli/update/dates/last.txt&#039;, $repo[&quot;updated_at&quot;]);
			}

			return $repo;
		}

		public function checkVersion($repo){

			if(!file_exists(&#039;.cli/update/dates/date.txt&#039;)){
				file_put_contents(&#039;.cli/update/dates/date.txt&#039;, $repo[&quot;created_at&quot;]);
			}

		}

		public function compare($date1){

			$pushDate = (array) new DateTime($date1);
			$date = &#039;.cli/update/dates/date.txt&#039;;
			$originDate = (array) new DateTime(file_get_contents($date));

			if($pushDate[&#039;date&#039;] &gt; $originDate[&#039;date&#039;]){

				$this-&gt;print(&quot;A uma nova versão mais recente disponivel.&quot;);
				$this-&gt;print(&quot;Aguarde iremos fazer a atualização!!&quot;);
				return true;

			}

			return false;

		}

		public function rm($name){
			system(&quot;rm -r {$name}&quot;);
		}

		public function extractAndMove($zipFile){

			$extractPath = &quot;.cli/update/downloads/cache/&quot;;
			$zip = new ZipArchive;

			$res = $zip-&gt;open($zipFile);

			if ($res === TRUE) {

				$zip-&gt;extractTo($extractPath);
				$zip-&gt;close();

				$this-&gt;rm(&#039;src&#039;);

				rename(
					&#039;.cli/update/downloads/cache/router-khan-master/src&#039;,
					&#039;src&#039;
				);
				rename(
					&#039;.cli/update/downloads/cache/router-khan-master/khan&#039;,
					&#039;khan&#039;
				);
				rename(
					&#039;.cli/update/downloads/cache/router-khan-master/documentation&#039;,
					&#039;documentation&#039;
				);

				rename(
					&#039;.cli/update/downloads/cache/router-khan-master/README.md&#039;,
					&#039;README.md&#039;
				);

				unlink(&#039;.cli/update/downloads/update.zip&#039;);
				
				$this-&gt;rm(&#039;.cli/update/downloads/cache/router-khan-master&#039;);

				$date = new DateTime();

				file_put_contents(
					&#039;.cli/update/dates/last.txt&#039;, 
					$date-&gt;format(&#039;Y-m-d&#039;)
				);

				$this-&gt;print(&quot;A atualização foi concluida com sucesso!!&quot;);

				return true;

			} else {

			  	$this-&gt;print(&quot;Erro ao atualizar!!&quot;);

			}

		}

		public function downloadZip(){
			$url = &quot;https://github.com/PaulaoDev/router-khan/archive/master.zip&quot;;
			$zipFile = &quot;.cli/update/downloads/update.zip&quot;;
			$zipResource = fopen($zipFile, &quot;w&quot;);
			// Get The Zip File From Server
			$ch = curl_init();
			curl_setopt($ch, CURLOPT_URL, $url);
			curl_setopt($ch, CURLOPT_FAILONERROR, true);
			curl_setopt($ch, CURLOPT_HEADER, 0);
			curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
			curl_setopt($ch, CURLOPT_AUTOREFERER, true);
			curl_setopt($ch, CURLOPT_BINARYTRANSFER,true);
			curl_setopt($ch, CURLOPT_TIMEOUT, 10);
			curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0); 
			curl_setopt($ch, CURLOPT_FILE, $zipResource);
			$page = curl_exec($ch);
			if(!$page) {
			 echo &quot;Error :- &quot;.curl_error($ch);
			}
			curl_close($ch);
			return (file_exists($zipFile)) ? $zipFile : false;
		}

		public function check(){

			$repo = $this-&gt;request();
			$this-&gt;data = $repo[&quot;updated_at&quot;];

			file_put_contents(&#039;.cli/update/dates/new.txt&#039;, $this-&gt;data);

			$this-&gt;checkVersion($repo);

			if($this-&gt;compare($this-&gt;data)){

					if($this-&gt;extractAndMove($this-&gt;downloadZip())){

						file_put_contents(&#039;.cli/update/dates/date.txt&#039;, file_get_contents(&#039;.cli/update/dates/new.txt&#039;));

					}

			}else{

				$this-&gt;print(&quot;O framework já está atualizado.&quot;);

			}

		}

	}
</code></pre>
    </div>
    <div class="row">
        <div id="footer">
    Generated by <a href="http://sami.sensiolabs.org/">Sami, the API Documentation Generator</a> using <a href="https://github.com/nochso/sami-theme">nochso/sami-theme</a>.
  </div>

    </div>
  </div>
    </body>

</html>
